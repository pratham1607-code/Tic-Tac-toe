/* eslint-disable */
// https://es6console.com/

(function() {
  function checkCache() {
    if (!window.caches) {
      return;
    }
    function getContentType(res) {
      return res.headers.get('content-type') || '';
    }
    function getType(url) {
      var typeMatch = (url || '').match(/\.([^.]+)$/);
      return ((typeMatch && typeMatch[1]) || '').toLowerCase();
    }
    var cacheKey = 'workbox-precache-https://www.free4talk.com/';
    var cacheKeyTemp = 'workbox-precache-https://www.free4talk.com/-temp';
    window.caches.keys().then(function(keys) {
      if (keys.indexOf(cacheKey) < 0) {
        console.info('Not found cache', cacheKey);
        return;
      }
      window.caches.open(cacheKey).then(function(cache) {
        cache.keys().then(function(requests) {
          requests.forEach(function(request) {
            var type = getType(request.url);
            if (type === 'html') {
              return;
            }
            cache.match(request).then(function(response) {
              var contentType = getContentType(response);
              if (contentType.indexOf('html') >= 0) {
                console.info('Removed wrong mine-type file', request.url);
                window.caches
                  .delete(cacheKey)
                  .then(function() {
                    return window.caches.delete(cacheKeyTemp);
                  })
                  .then(function() {
                    if ('serviceWorker' in navigator) {
                      return navigator.serviceWorker.ready
                        .then(function(registration) {
                          return registration.unregister();
                        })
                        .then(function() {
                          window.location.reload(true);
                        });
                    }
                    return null;
                  });
              }
            });
          });
        });
      });
    });
  }

  setTimeout(checkCache, 1000);
})();
